# **Day 21 - Introduction to Malware Analysis**

##  **Objective:**

Today’s goal is to understand the fundamentals of **malware analysis** from a SOC analyst’s perspective by focusing on **static analysis techniques**. This includes using tools like **VirusTotal**, **Hybrid Analysis**, and **CyberChef** to examine file metadata, detect antivirus signatures, extract strings, and identify indicators of compromise (IOCs). Through hands-on analysis of the safe **EICAR test file**, I practiced key workflows to recognize malicious behavior, inform detection strategies, and enhance incident response readiness in a SOC environment.


##  **What is Malware Analysis?**

**Malware Analysis** is the process of examining malicious software to understand its origin, behavior, impact, and indicators. It helps SOC analysts detect infections, contain threats, and prevent future compromises.

###  Types of Malware Analysis:
- **Static Analysis:** Examining a file without executing it
- **Dynamic Analysis:** Observing file behavior during execution (sandboxing)
- **Memory Analysis:** Investigating malware artifacts in memory
- **Reverse Engineering:** Deconstructing the code (advanced)


###  **Why Malware Analysis Is Critical in a SOC**

In a Security Operations Center (SOC), malware analysis helps answer critical incident response questions:

| Question                       | Purpose                                               |
| ------------------------------ | ----------------------------------------------------- |
| What does this malware do?     | Helps scope the impact of the breach                  |
| How did it get in?             | Determines initial infection vector                   |
| What systems are affected?     | Assists in containment and isolation                  |
| Is it part of a bigger attack? | Connects to campaigns or threat actors                |
| How do we detect and block it? | Generates IOCs, detection rules, and response actions |

> In a SOC, malware analysis is not just about understanding the malware — it's about using that knowledge to **respond fast and prevent recurrence**.
 
### **SOC Workflow: Where Malware Analysis Fits**

1. **Detection:** Malware triggers alert (email, EDR, SIEM, etc.)
2. **Triage:** Analyst confirms file is suspicious
3. **Extraction:** File is pulled and handed to malware analysis (static/dynamic)
4. **Analysis:** Understand behavior, impact, and IOCs
5. **Containment:** Isolate infected systems
6. **Hunting:** Search SIEM/EDR for other infections (pivot on hashes, domains, etc.)
7. **Remediation:** Clean systems, patch vulnerabilities
8. **Detection Engineering:** Write new rules to catch similar attacks
9. **Reporting:** Document findings and improve defenses

##  **SOC Use Cases for Malware Analysis**

| Use Case                    | Description                                                     |
| --------------------------- | --------------------------------------------------------------- |
|  Phishing investigation   | Analyze attachment or payload                                   |
|  Zero-day threat          | Reverse or sandbox unknown malware                              |
|  Ransomware outbreak      | Understand payload, encryption logic, recover files if possible |
|  C2 beacon detection      | Analyze malware’s communication patterns                        |
|  Threat campaign tracking | Link malware to known threat actors or campaigns                |
|  Detection tuning         | Build custom **YARA**, **Snort**, or **EDR** rules              |


##  **Static Malware Analysis – Activity, Purpose, and Tools**

| **Activity**                          | **Purpose**                                                      | **Tools You Can Use**                                           |
|--------------------------------------|------------------------------------------------------------------|------------------------------------------------------------------|
|  Check File Hash (MD5/SHA256)      | Identify file uniquely and compare with threat intel databases   | VirusTotal, HashCalc, HashMyFiles, PowerShell `Get-FileHash`    |
|  Check Antivirus Detections        | See if AV engines detect the file as malicious                   | VirusTotal, MetaDefender, Hybrid Analysis                       |
|  Inspect File Metadata             | Gather file details like size, type, timestamps, compile date    | ExifTool, PEStudio, Detect It Easy (DIE), `file` command         |
|  Check File Type & Entropy         | Detect packing, encryption, or file manipulation                 | Detect It Easy (DIE), PEStudio, binwalk                         |
|  Extract Strings                   | Reveal readable content like domains, URLs, commands             | `strings`, FLOSS (FireEye), BinText                            |
|  Detect Obfuscation or Packing     | Identify if the file is packed to hide malicious code            | PEiD, Detect It Easy (DIE), PEStudio                            |
|  Scan Embedded Domains or URLs     | Uncover external connections or phishing links                   | VirusTotal, CyberChef, URLScan.io                              |
|  Analyze Imports/Functions         | Understand what Windows APIs or system calls the file uses       | PEStudio, CFF Explorer, IDA Free, Ghidra                        |
|  Compare to Known Malware Samples  | Check similarity to known malware families or signatures         | Intezer Analyze, Hybrid Analysis, VirusTotal Behavior           |
|  Hex & Binary Inspection           | Manually examine binary structure for hidden artifacts           | HxD, Hexed.it, 010 Editor                                       |


##  **Lab Tasks – Perform Static Malware Analysis**


##  **Lab Setup**

I will perform basic static malware analysis using a publicly known test malware file.
>  **I will use a safe EICAR test file** – not harmful, but detected by AV tools.

###  Tools You’ll Use:
- [EICAR Test Malware Sample FIle](https://www.eicar.org/download/eicar-com-2/?wpdmdl=8842&refresh=67f24bb33b5f41743932339)
- [VirusTotal](https://www.virustotal.com)
- [Hybrid Analysis](https://www.hybrid-analysis.com/)
- [Any.Run (Optional)](https://any.run)
- [CyberChef](https://gchq.github.io/CyberChef)
- [Intezer Analyze (Optional)](https://analyze.intezer.com/)
- Strings or Hex Viewer (e.g., [https://hexed.it](https://hexed.it))

---
### Static Analysis Findings

| **Analysis Point** | **Result**                                                     |
| ------------------ | -------------------------------------------------------------- |
| **File Type**      | `.txt` executable (text/plain MIME)                            |
| **Detection Name** | EICAR-Test-File (Safe test virus string)                       |
| **Threat Score**   | 100/100 (Hybrid Analysis)                                      |
| **AV Detections**  | 20/26 (MetaDefender) on Hybrid Analysis<br>60/67 on VirusTotal |
| **Threat Label**   | `virus.eicar/test`                                             |
| **Behavior Tags**  | `powershell`, `idle`, `attachment`, `known-distributor`        |
| **Family Labels**  | `eicar`, `test`, `file`                                        |


### Anti-Virus & Sandbox Results

#### ybrid Analysis:
- Threat Score: 100/100
- Labeled As: Malicious (EICAR)
- AV Detection Rate: 20/26 engines flagged it
- Last Scan: July 20, 2025

### VirusTotal:

- Detection Rate: 60 out of 67 vendors marked it as EICAR-Test-File
- Popular Tags: virus.eicar/test, file, test, not a virus
- Community Score: 224
- File Behavior: Flagged due to known test signature; no real payload or execution traces

## Conclusion:

**Malware analysis in a SOC** bridges the gap between **detection and action**. It gives analysts the visibility and insight to:

* Understand the malware’s behavior
* Contain infections quickly
* Harden systems
* Build detection capabilities
* Prevent future attacks

> It's one of the most **hands-on, investigative, and rewarding** aspects of SOC work.


